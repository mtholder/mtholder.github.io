<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<style>
.question {
    font-size: 48;
    font-family: "Comic Sans MS", cursive, sans-serif ;
}
.feedback {
    font-size: 48;
    font-family: "Comic Sans MS", cursive, sans-serif ;
}
</style>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
</head>
<body>
<table>
    <tr><td>
       <p class="question"><span id="leftoperand"></span>
       <span id="operator"></span>
       <span id="rightoperand"></span> = <input onkeyup="answerKeyUp" type="text" id="ans">
       </p>
       <p class="feedback"><div id="response" /><br /></p> </td></tr>
   <tr><td> <span id="animatepar" /></td></tr>
</table>
<script>
var fontColorChoices = ["red",
                        "green",
                        "orange",
                        "purple",
                        "blue",
                        "cyan",
                        "black"];
var fontFamilyChoices = ["Impact,Charcoal,sans-serif",
                         "Comic Sans MS,cursive,sans-serif",
                         "Trebuchet MS, Helvetica, sans-serif",
                         "Arial Black, Gadget, sans-serif",
                         "Lucida Console, Monaco, monospace",
                         ];
var yayTextChoices = ["Correct",
                      "Nice job",
                      "That is right",
                      "Sehr gut",
                      "Richtig",
                      "Genau",
                      "Ausgezeichnet"];
var emojiChoices = ["(‚Ä¢œâ‚Ä¢)",
                    "‚ò∫", 
                    " ï‚Ä¢·¥•‚Ä¢ î",
                    "‡≤†‚å£‡≤†",
                    "‡πÇ‡πè‡Ø∞‡πè‡πÉ",
                    "( Õ°¬∞ Õú ñ Õ°¬∞)",
                    "üòÖ",
                    "üòé",
                    "üòπ",
                    "üò∫",
                    "üòª",
                    "<br />               (\"\ '' /\").___..--' ' \"`-._  <br />                                   `‡≤†_ ‡≤†  )   `-.  (       ).`-.__.`) <br />                   (_Y_.)'    ._   )  `._ `. ``-..-' <br />                                _..`--'_. .-_/  /--'_.'  .'          <br />                                            (i l).-' '    ((i). '   ((!.-'i<br />",
                    "‚òÉ"];
var sad_emoticons = ["‚òπ"];
var leftOpSpan = document.getElementById("leftoperand");
var operatorSpan = document.getElementById("operator");
var rightOpSpan = document.getElementById("rightoperand");
var responseDiv = document.getElementById("response");
var ansBoxInput = document.getElementById("ans");
var MAT_WIDTH = 200;
var FIG_HEIGHT = 80;
var OFFSET = 10;
var margin = {top: 20, right: 25, bottom: 10, left: 15};
var src_svg = d3.select('#animatepar').append('svg')
    .attr({'width': MAT_WIDTH + margin.left + margin.right,
           'height': FIG_HEIGHT + margin.bottom + margin.top, })
    .style('background', 'white');
var correct;
var leftOpVal;
var rightOpVal;
var operator;
var animate = function() {
    var src_data = [{"x": Math.random(),
                     "y": Math.random()}];
    var r = src_svg.selectAll("text")
        .data(src_data, function(d) {return d;});
    r.enter()
        .append("text")
        .attr("x", function(d) {return margin.left + MAT_WIDTH*d.x;})
     .attr("y", function(d) {return margin.top + FIG_HEIGHT*d.y;})
     .attr("fill", function(d) {return '#FF0000'})
     .attr("font-size", "44px")
     .text("‚ò∫");
    r.transition()
     .duration(350)
     .attr('text-anchor', 'middle')
     .attr("x", function(d) {return margin.left + MAT_WIDTH*(1.0 - d.x);})
     .attr("y", function(d) {return FIG_HEIGHT*(1.0 - d.y) + margin.top;});

     //.attr("transform", function(d) {return "rotate(1," + margin.left + MAT_WIDTH*(1.0 - d.x) + "," + margin.top + FIG_HEIGHT*(1.0 - d.y) + ")"});
};
var askQuestion = function() {
    leftOpVal = Math.round(Math.random()*10.99 - .495);
    rightOpVal = Math.round(Math.random()*10.99 - .495);
    var opU = Math.random();
    operator = "+";
    if (opU < .25) {
        if (opU < .1) {
            operator = "+";
        } else {
            operator = "-";
        }
    } else {
        if (opU < .75) {
            operator = "√ó";
        } else {
            operator = "/";
        }
    }
    if (operator == "+") {
        correct = leftOpVal + rightOpVal;
    } else if (operator == "-") {
        correct = leftOpVal - rightOpVal;
    } else if (operator == "√ó") {
        correct = leftOpVal * rightOpVal;
    } else {
        while (rightOpVal == 0) {
            rightOpVal = Math.round(Math.random()*10.99 - .495);
        }
        correct = leftOpVal;
        leftOpVal *= rightOpVal;
    }
    leftOpSpan.innerHTML = "" + leftOpVal;
    operatorSpan.innerHTML = operator;
    rightOpSpan.innerHTML = "" + rightOpVal;
}
var randChoice = function (choices) {
    var cind = Math.round(Math.random()*(choices.length - .01) - .495);
    return choices[cind];
}
var processResponse = function() {
    var resp = ansBoxInput.value;
    if (resp == correct) {
        responseDiv.style.color = randChoice(fontColorChoices);
        responseDiv.style.fontFamily = randChoice(fontFamilyChoices);
        responseDiv.innerHTML = randChoice(yayTextChoices) + " ! " + randChoice(emojiChoices);
        animate();
    } else {
        responseDiv.innerHTML = "Nope. " + leftOpVal + " " + operator + " " + rightOpVal + " = " + correct;
    }
}

askQuestion();
animate();
function answerKeyUp(event) {
    var c = event.which || event.keyCode ;
    if (c == 13) {
        processResponse();
        ansBoxInput.value = "";
        askQuestion();
    } else {
        /*responseDiv.innerHTML = "" + c; */
    }
}
ansBoxInput.addEventListener("keyup", answerKeyUp);

</script>
</body>
</html>

